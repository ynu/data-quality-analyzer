# HiAgent v2.1.0 智能体接⼝⽂档

## 背景
HiAgent平台提供将智能体作为后端服务API被业务请求的能⼒，⽤以满⾜客⼾希望⾃主构建前端交互⻚⾯，或者将智能体加⼊到当前已有业务服务调⽤链路中的场景需求。

## 基本信息
API 接⼝地址：https://agent.ynu.edu.cn/api/proxy/api/v1

## 前置依赖
1. 完成智能体调试与发布
2. 打开API访问开关；

## 调⽤步骤（以对话类聊天为例）
- 第⼀步：在智能体预览⻚右侧，获取API调⽤的URL和鉴权⽤的{{ApiKey}}
- 第⼆步：
  - 在请求header加上Apikey={{ApiKey}}，body参数中包括AppKey，也赋值为{{ApiKey}}；
  - 所有接⼝需要在Body中加上UserID，UserID为调⽤API的⽤⼾ID（⽤⼾标识，⽤于定义终端⽤⼾的⾝份，⽅便检索、统计。 由开发者定义规则，需保证⽤⼾标识在应⽤内唯⼀）；
- 第三步：开始对话（通⽤流程）
  - 选择⼀个合适的应⽤，获取应⽤AppID，调⽤[CreateConversation](https://agent.ynu.edu.cn/api/proxy/api/v1/create_conversation)⽣成⼀个会话ID；
  - 调⽤[ChatQueryV2](https://agent.ynu.edu.cn/api/proxy/api/v1/chat_query_v2)接⼝（所有流式接⼝都是SSE），传⼊会话ID，即可开始聊天，返回流式的对话数据；
  - 停⽌聊天：在流式输出的过程中调⽤StopMessage接⼝，即可停⽌聊天；
  - 重新⽣成：如果需要重新⽣成聊天结果，调⽤QueryAgain，可重新⽣成聊天结果；  
  - 结果反馈：调⽤Feedback接⼝，传⼊消息ID，可对回答进⾏反馈评价（赞或踩）；
  - 查看聊天历史：获取会话的聊天历史：GetConversationMessages；

## 服务：ChatService
### API 列表概览
ChatQuery: 对话类聊天
ChatQueryV2: 对话类聊天V2
QueryAgain: 重新⽣成回复
GetAppConfigPreview: 获取应⽤配置
GetConversationList: 获取对话列表
GetConversationInputs: 获取对话变量输⼊
CreateConversation: 创建会话
UpdateConversation: 更新会话
DeleteConversation: 删除会话
StopMessage: 停⽌响应
GetConversationMessages: 获取会话历史消息列表
GetMessageInfo: 获取消息详情
DeleteMessage: 删除消息
Feedback: 回答反馈评价（赞或踩）
SetMessageAnswerUsed: 多组回答时，设置某个回答为默认使⽤的回答
GetSuggestedQuestions: 获取提问建议
RunAppWorkflow: 测试运⾏⼯作流(异步)
QueryRunAppProcess: 查询测试运⾏⼯作流运⾏进展(异步)
ListOauth2Token: 查询⽤⼾oauth2登录信息的接⼝
QueryAgainV2: 重新⽣成回复V2
ClearMessage: 清除消息
SyncRunAppWorkflow: 测试运⾏⼯作流(同步)
CallTriggerWebhook: 触发事件触发器
ChatContinue：继续对话
ListLongMemory：获取⻓期记忆列表
UpdateLongMemory：更新⻓期记忆
DeleteLongMemory：删除⻓期记忆
ClearLongMemory：清除⻓期记忆
SetConversationTop：置顶会话
CancelConversationTop：取消会话置顶
QuerySkillAsyncTask：查询智能体技能⼯具异步任务
AsyncResumeAppWorkflow: 异步恢复⼯作流运⾏
SyncResumeAppWorkflow: 同步恢复⼯作流执⾏
GetAppUserVariables：获取智能体⽤⼾环境变量
SetAppUserVariables：设置智能体⽤⼾环境变量
QueryTriggerRunRecords：查询触发器运⾏记录

## API 接口
### CreateConversation: 创建会话
- 接⼝说明：对话类聊天接⼝，需要先⽣成会话，会话ID为AppConversationID，后续的聊天接⼝ChatQuery都需要传⼊会话ID。
- 请求header说明：
    - 请求header需要加上Apikey={{ ApiKey }}；
- body参数说明：
    - UserID：⽤⼾标识，⽤于定义终端⽤⼾的⾝份，⽅便检索、统计。 由开发者定义规则，需保证⽤⼾标识在应⽤内唯⼀。（⻓度：1-20） ；
- response body参数说明：
    - Conversation：AppConversationID,后续的聊天接⼝ChatQuery都需要传⼊会话ID;ConversationName,会话默认名（可修改）；

#### 请求 (app.CreateConversationRequest):
参数 类型 是否必填 参数作⽤域 说明
AppKey string false "Request header" "应⽤key。http 请求头中设置 Apikey={{ApiKey }}"
Inputs map[string, string] false "Request body(json)" "变量输⼊。可选，根据应⽤编排时设置的变量确定"
UserID string true "Request body(json)" "⽤⼾ID"

#### 响应 (app.CreateConversationResponse):
参数 类型 参数作⽤域 说明
Conversation app.Conversation false "Response body(json)" "对话信息"

#### app.Conversation:
参数 类型 参数作⽤域 说明
AppConversationID string false "Response body(json)" "会话ID"
ConversationName string false "Response body(json)" "会话默认名（可修改）"

### ChatQueryV2: 对话类聊天V2
- 接⼝说明：对话类聊天接⼝，需要传⼊会话ID。
- 请求header说明：
    - 请求header需要加上Apikey={{ ApiKey }}；
- body参数说明：
    - AppConversationID：会话ID，调⽤CreateConversation接⼝⽣成；
    - UserID：⽤⼾标识，⽤于定义终端⽤⼾的⾝份，⽅便检索、统计。 由开发者定义规则，需保证⽤⼾标识在应⽤内唯⼀。（⻓度：1-20） ；
    - Inputs：变量输⼊。可选，根据应⽤编排时设置的变量确定；
    - ResponseMode：响应模式。
        - streaming 流式模式（推荐）。
        - blocking 阻塞模式，返回完整的消息内容（json格式返回，区别于chat_query,返回不是SSE格式的）；

#### 请求 (app.ChatQueryRequest):
参数 类型 是否必填 参数作⽤域 说明
AppKey string false "Request header" "应⽤key。http 请求头中设置 Apikey={{ApiKey }}"
AppConversationID string true "Request body(json)" "会话ID"
Query string true "Request body(json)" "用户输入"
ResponseMode string false "Request body(json)" "响应模式"
QueryExtends app.QueryExtendsInfo false "Request body(json)" "查询扩展信息"
UserID string true "Request body(json)" "⽤⼾ID"

#### 响应 (app.MessageStreamResponse):
参数 类型 参数作⽤域 说明

